# AirSense å¿«é€Ÿå¼€å§‹æŒ‡å—

5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹ä½ çš„AirSenseç©ºæ°”è´¨é‡æ£€æµ‹ä»ªï¼

## ç¬¬ä¸€æ­¥ï¼šç¡¬ä»¶è¿æ¥

### æœ€å°ç³»ç»Ÿ (ä»…ESP32-C5 + CO2ä¼ æ„Ÿå™¨)

```
SenseAir S8          ESP32-C5
VDD (5V)    â”€â”€â”€â”€â”€â”€â”€â”€â–º 5V
GND         â”€â”€â”€â”€â”€â”€â”€â”€â–º GND
RX          â”€â”€â”€â”€â”€â”€â”€â”€â–º GPIO17 (TX)
TX          â”€â”€â”€â”€â”€â”€â”€â”€â–º GPIO18 (RX)
```

### å®Œæ•´ç³»ç»Ÿè¿æ¥å‚è€ƒ

è¯¦ç»†è¿æ¥å›¾è¯·å‚è€ƒ: [ç¡¬ä»¶è¿æ¥æŒ‡å—](doc/hardware_setup.md)

## ç¬¬äºŒæ­¥ï¼šå®‰è£…å¼€å‘ç¯å¢ƒ

### Windowsç”¨æˆ·

1. ä¸‹è½½ESP-IDFç¦»çº¿å®‰è£…å™¨
   - è®¿é—®: https://dl.espressif.com/dl/esp-idf/
   - ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ (æ¨èv5.0+)

2. å®‰è£…åˆ°é»˜è®¤è·¯å¾„: `C:\Espressif\`

3. æ‰“å¼€"ESP-IDF Command Prompt" (ä»å¼€å§‹èœå•)

### Linux/Macç”¨æˆ·

```bash
# å¿«é€Ÿå®‰è£…è„šæœ¬
mkdir -p ~/esp
cd ~/esp
git clone --recursive https://github.com/espressif/esp-idf.git
cd esp-idf
./install.sh esp32c5
. ./export.sh
```

## ç¬¬ä¸‰æ­¥ï¼šç¼–è¯‘å’Œçƒ§å½•

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/AirSense

# 2. è®¾ç½®ç›®æ ‡èŠ¯ç‰‡
idf.py set-target esp32c5

# 3. ç¼–è¯‘é¡¹ç›®
idf.py build

# 4. çƒ§å½•åˆ°è®¾å¤‡ (æ›¿æ¢COM3ä¸ºä½ çš„ç«¯å£)
# Windows: COM3, COM4, etc.
# Linux: /dev/ttyUSB0
# Mac: /dev/cu.usbserial-xxx
idf.py -p COM3 flash monitor
```

## ç¬¬å››æ­¥ï¼šæŸ¥çœ‹è¾“å‡º

çƒ§å½•æˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š

```
I (320) AirSense: AirSense Air Quality Monitor
I (325) AirSense: MCU: ESP32-C5
I (330) AirSense: Version: 1.0.0
I (340) SenseAir_S8: SenseAir S8 initialized on UART1
I (350) SGP41: SGP41 initialized on I2C0
I (370) Dart_WZH3N: Dart WZ-H3-N initialized on UART2
I (385) AirSense: System started successfully

I (5390) AirSense: === Reading Sensors ===
[S8] CO2: 412 ppm, Status: 0x00
[SGP41] VOC raw: 23456, NOx raw: 12345, VOC index: 178, NOx index: 93
[Dart] NH3: 0.12 ppm, Full Range: 100 ppm
```

## å¸¸è§é—®é¢˜

### Q1: çƒ§å½•å¤±è´¥ "Failed to connect"

**è§£å†³æ–¹æ¡ˆ**:
1. æŒ‰ä½ESP32-C5çš„BOOTæŒ‰é’®
2. æŒ‰ä¸€ä¸‹RSTæŒ‰é’®å¤ä½
3. æ¾å¼€BOOTæŒ‰é’®
4. é‡æ–°è¿è¡Œ `idf.py -p COM3 flash`

### Q2: ä¼ æ„Ÿå™¨è¯»æ•°å…¨éƒ¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ‰€æœ‰ä¼ æ„Ÿå™¨ä¾›ç”µæ˜¯å¦æ­£å¸¸
2. ç”¨ä¸‡ç”¨è¡¨æµ‹é‡ç”µå‹: 3.3Vå’Œ5V
3. æ£€æŸ¥æ¥çº¿æ˜¯å¦ç‰¢å›º
4. å‚è€ƒ[ç¡¬ä»¶è¿æ¥æŒ‡å—](doc/hardware_setup.md)

### Q3: CO2è¯»æ•°ä¸º0æˆ–å¼‚å¸¸

**è§£å†³æ–¹æ¡ˆ**:
1. SenseAir S8éœ€è¦å‡ åˆ†é’Ÿé¢„çƒ­
2. æ£€æŸ¥TX/RXå¼•è„šæ˜¯å¦æ¥å
3. ç¡®è®¤æ³¢ç‰¹ç‡ä¸º9600

### Q4: I2Cä¼ æ„Ÿå™¨æ— å“åº”

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥SDA/SCLä¸Šæ˜¯å¦æœ‰4.7kÎ©ä¸Šæ‹‰ç”µé˜»
2. ç¡®è®¤I2Cåœ°å€æ­£ç¡®: SGP41=0x59, DPS310=0x77
3. å°è¯•é™ä½I2Cé¢‘ç‡ (ä¿®æ”¹ä»£ç ä¸­çš„é¢‘ç‡è®¾ç½®)

## ä¸‹ä¸€æ­¥

æ­å–œï¼ä½ çš„AirSenseå·²ç»è¿è¡Œèµ·æ¥äº†ï¼

æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š

1. **ä¿®æ”¹å¼•è„šé…ç½®**
   - ç¼–è¾‘ `src/main.c`
   - ä¿®æ”¹å¼•è„šå®å®šä¹‰
   - é‡æ–°ç¼–è¯‘å’Œçƒ§å½•

2. **è°ƒæ•´é‡‡æ ·é¢‘ç‡**
   - ä¿®æ”¹ `MEASURE_INTERVAL_MS`
   - é»˜è®¤5ç§’ï¼Œå¯æ”¹ä¸º1-60ç§’

3. **æ·»åŠ æ˜¾ç¤ºå±**
   - é›†æˆOLED/LCDæ˜¾ç¤º
   - å®æ—¶æ˜¾ç¤ºä¼ æ„Ÿå™¨æ•°æ®

4. **æ·»åŠ WiFiåŠŸèƒ½**
   - ä¸Šä¼ æ•°æ®åˆ°äº‘ç«¯
   - è¿œç¨‹ç›‘æ§

5. **å¼€å‘æ‰‹æœºAPP**
   - è“ç‰™è¿æ¥
   - å†å²æ•°æ®æŸ¥çœ‹

## è·å–å¸®åŠ©

- ğŸ“– [å®Œæ•´æ–‡æ¡£](README.md)
- ğŸ”§ [ç¡¬ä»¶è¿æ¥æŒ‡å—](doc/hardware_setup.md)
- ğŸ› ï¸ [ç¼–è¯‘æŒ‡å—](doc/build_guide.md)
- ğŸ› [æäº¤Issue](https://github.com/yourusername/AirSense/issues)

## é¡¹ç›®æ–‡ä»¶è¯´æ˜

```
AirSense/
â”œâ”€â”€ CMakeLists.txt                 # é¡¶å±‚CMakeé…ç½®
â”œâ”€â”€ sdkconfig.defaults             # ESP-IDFé»˜è®¤é…ç½®
â”œâ”€â”€ README.md                      # å®Œæ•´é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ QUICKSTART.md                  # æœ¬æ–‡ä»¶
â”œâ”€â”€ doc/
â”‚   â”œâ”€â”€ build_guide.md            # è¯¦ç»†ç¼–è¯‘æŒ‡å—
â”‚   â””â”€â”€ hardware_setup.md         # ç¡¬ä»¶è¿æ¥è¯¦è§£
â””â”€â”€ src/
    â”œâ”€â”€ main.c                     # ä¸»ç¨‹åº
    â””â”€â”€ sensors/                   # ä¼ æ„Ÿå™¨é©±åŠ¨
        â”œâ”€â”€ senseair_s8.h/c       # CO2ä¼ æ„Ÿå™¨
        â”œâ”€â”€ sgp41.h/c             # VOC/NOxä¼ æ„Ÿå™¨
        â”œâ”€â”€ dart_wzh3n.h/c        # NH3ä¼ æ„Ÿå™¨
        â””â”€â”€ dps310.h/c            # æ°”å‹ä¼ æ„Ÿå™¨
```

## ä»£ç ä¿®æ”¹ç¤ºä¾‹

### ä¿®æ”¹é‡‡æ ·é—´éš”

ç¼–è¾‘ `src/main.c`:

```c
// ä»5ç§’æ”¹ä¸º10ç§’
#define MEASURE_INTERVAL_MS     10000
```

### ä¿®æ”¹å¼•è„šå®šä¹‰

ç¼–è¾‘ `src/main.c`:

```c
// ä¿®æ”¹ä¸ºä½ çš„å®é™…å¼•è„š
#define S8_TX_PIN               GPIO_NUM_10  // åŸæ¥æ˜¯GPIO17
#define S8_RX_PIN               GPIO_NUM_11  // åŸæ¥æ˜¯GPIO18
```

### ä¿®æ”¹æ—¥å¿—çº§åˆ«

ç¼–è¾‘ `src/main.c`ï¼Œåœ¨ `app_main()` ä¸­æ·»åŠ :

```c
void app_main(void) {
    // è®¾ç½®æ—¥å¿—çº§åˆ«
    esp_log_level_set("*", ESP_LOG_INFO);          // å…¨å±€INFO
    esp_log_level_set("AirSense", ESP_LOG_DEBUG);  // ä¸»ç¨‹åºDEBUG

    // ... å…¶ä»–ä»£ç 
}
```

## æ€§èƒ½ä¼˜åŒ–æç¤º

1. **é™ä½åŠŸè€—**
   - ä½¿ç”¨æ·±åº¦ç¡çœ æ¨¡å¼
   - å…³é—­ä¸ç”¨çš„ä¼ æ„Ÿå™¨
   - é™ä½é‡‡æ ·é¢‘ç‡

2. **æé«˜ç²¾åº¦**
   - ç­‰å¾…ä¼ æ„Ÿå™¨å……åˆ†é¢„çƒ­
   - ä½¿ç”¨æ¸©æ¹¿åº¦è¡¥å¿ (SGP41)
   - å®šæœŸæ ¡å‡†CO2ä¼ æ„Ÿå™¨

3. **å¢å¼ºç¨³å®šæ€§**
   - æ·»åŠ é”™è¯¯é‡è¯•æœºåˆ¶
   - å®ç°çœ‹é—¨ç‹—
   - ä½¿ç”¨æ»¤æ³¢ç®—æ³•å¹³æ»‘æ•°æ®

---

**ç¥ä½ ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒå®Œæ•´æ–‡æ¡£æˆ–æäº¤Issueã€‚
